(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[457],{6245:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>x});var n=s(5155),a=s(2619),r=s.n(a),i=s(2115),o=s(5149),l=s(1839),c=s(8525),d=s(8232),m=s(2369);function x(){let{user:e,loading:t,isAuthenticated:s}=(0,l.J)(),[a,x]=(0,i.useState)([]),[u,b]=(0,i.useState)([]),[h,p]=(0,i.useState)("Create or join an arena room to discuss plans."),[g,_]=(0,i.useState)(d.X0[0].id),[f,N]=(0,i.useState)(""),[z,j]=(0,i.useState)(null),[v,y]=(0,i.useState)(""),[C,w]=(0,i.useState)(!1),k=(0,i.useMemo)(()=>(0,m.E$)(),[]),E=(0,i.useMemo)(()=>C&&k?a.filter(e=>k.interests.includes(e.sport)):a,[a,C,k]);(0,i.useEffect)(()=>{if(!s)return void x([]);(async()=>{let{data:e,error:t}=await c.N.from("arena_chat_rooms").select("id, arena_id, arena_name, sport, topic, created_by_user_id, created_by_email, created_at").order("created_at",{ascending:!1});if(t)return p(t.message);x(null!=e?e:[])})()},[s]),(0,i.useEffect)(()=>{if(!s)return;let e=c.N.channel("arena_chat_rooms_realtime").on("postgres_changes",{event:"INSERT",schema:"public",table:"arena_chat_rooms"},e=>{let t=e.new;x(e=>e.some(e=>e.id===t.id)?e:[t,...e])}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"arena_chat_rooms"},e=>{let t=e.new;x(e=>e.map(e=>e.id===t.id?t:e))}).on("postgres_changes",{event:"DELETE",schema:"public",table:"arena_chat_rooms"},e=>{let t=String(e.old.id);x(e=>e.filter(e=>e.id!==t)),j(e=>e===t?null:e)}).subscribe();return()=>{c.N.removeChannel(e)}},[s]),(0,i.useEffect)(()=>{if(!z&&a.length>0)return void j(a[0].id);if(z&&!a.some(e=>e.id===z)){var e,t;j(null!=(t=null==(e=a[0])?void 0:e.id)?t:null)}},[a,z]),(0,i.useEffect)(()=>{if(!s||!z)return void b([]);(async()=>{let{data:e,error:t}=await c.N.from("messages").select("id, room_id, user_id, user_email, sender_name, text, created_at").eq("room_id",z).order("created_at",{ascending:!0});if(t)return p(t.message);b(null!=e?e:[])})();let e=c.N.channel("room_messages_realtime_".concat(z)).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:"room_id=eq.".concat(z)},e=>{let t=e.new;b(e=>e.some(e=>e.id===t.id)?e:[...e,t])}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"messages",filter:"room_id=eq.".concat(z)},e=>{let t=e.new;b(e=>e.map(e=>e.id===t.id?t:e))}).on("postgres_changes",{event:"DELETE",schema:"public",table:"messages",filter:"room_id=eq.".concat(z)},e=>{let t=String(e.old.id);b(e=>e.filter(e=>e.id!==t))}).subscribe();return()=>{c.N.removeChannel(e)}},[s,z]);let S=async()=>{var t,s;if(!e)return;let n=null!=(t=d.X0.find(e=>e.id===g))?t:d.X0[0],a=f.trim()||"Discussion for ".concat(n.name),{data:r,error:i}=await c.N.from("arena_chat_rooms").insert({arena_id:n.id,arena_name:n.name,sport:n.sport,topic:a,created_by_user_id:e.id,created_by_email:null!=(s=e.email)?s:"unknown@zevo.app"}).select("id, arena_id, arena_name, sport, topic, created_by_user_id, created_by_email, created_at").single();if(i)return void p(i.message);j(r.id),N(""),p("Arena room created. You can start discussion now.")},A=async()=>{var t,s,n,a,r,i;if(!e||!z||!v.trim())return;let o=null!=(r=null!=(a=null!=(n=null==(t=e.user_metadata)?void 0:t.username)?n:null==(s=e.user_metadata)?void 0:s.full_name)?a:e.email)?r:"Zevo User",{error:l}=await c.N.from("messages").insert({room_id:z,user_id:e.id,user_email:null!=(i=e.email)?i:"unknown@zevo.app",sender_name:o,text:v.trim()});if(l)return void p(l.message);y("")};return t?(0,n.jsx)(o.q,{children:(0,n.jsxs)("section",{className:"rounded-3xl border border-zinc-800 bg-zinc-900/70 p-6",children:[(0,n.jsx)("h1",{className:"text-3xl font-black",children:"Public Arena Chat"}),(0,n.jsx)("p",{className:"mt-2 text-sm text-zinc-400",children:"Checking your session..."})]})}):s?(0,n.jsxs)(o.q,{children:[(0,n.jsxs)("section",{className:"mb-6 rounded-3xl border border-zinc-800 bg-zinc-900/70 p-6",children:[(0,n.jsx)("h1",{className:"text-3xl font-black",children:"Public Arena Chat"}),(0,n.jsx)("p",{className:"mt-2 text-sm text-zinc-400",children:"Create chat rooms for specific arenas so interested players can join, ask questions, and plan together."}),(0,n.jsx)("p",{className:"mt-3 text-xs text-zinc-300",children:h})]}),(0,n.jsxs)("section",{className:"mb-4 rounded-2xl border border-zinc-800 bg-zinc-900/70 p-4",children:[(0,n.jsx)("h2",{className:"text-sm font-semibold",children:"Create Arena Chat Room"}),(0,n.jsxs)("div",{className:"mt-3 grid gap-2 sm:grid-cols-2",children:[(0,n.jsx)("select",{value:g,onChange:e=>_(e.target.value),className:"rounded-xl border border-zinc-700 bg-zinc-800 px-3 py-2 text-sm text-zinc-100",children:d.X0.map(e=>(0,n.jsxs)("option",{value:e.id,children:[e.name," - ",e.sport]},e.id))}),(0,n.jsx)("input",{value:f,onChange:e=>N(e.target.value),placeholder:"Room topic (e.g. Saturday 7 AM planning)",className:"rounded-xl border border-zinc-700 bg-zinc-800 px-3 py-2 text-sm text-zinc-100"})]}),(0,n.jsx)("button",{type:"button",onClick:S,className:"mt-3 rounded-xl bg-neon px-4 py-2 text-xs font-bold text-zinc-900",children:"Create Chat Room"})]}),(0,n.jsx)("section",{className:"mb-3",children:(0,n.jsx)("button",{type:"button",onClick:()=>w(e=>!e),className:"rounded-full border px-3 py-1 text-xs font-semibold ".concat(C?"border-neon bg-neon text-zinc-900":"border-zinc-700 bg-zinc-800 text-zinc-300 hover:border-zinc-500"),children:C?"Showing My Interests":"Show Only My Interested Arenas"})}),(0,n.jsxs)("section",{className:"grid gap-4 lg:grid-cols-[0.9fr_1.1fr]",children:[(0,n.jsxs)("article",{className:"rounded-2xl border border-zinc-800 bg-zinc-900/70 p-3",children:[(0,n.jsx)("h2",{className:"text-sm font-semibold",children:"Arena Chat Rooms"}),(0,n.jsx)("div",{className:"mt-3 max-h-[460px] space-y-2 overflow-y-auto",children:0===E.length?(0,n.jsx)("p",{className:"text-sm text-zinc-400",children:"No chat rooms found."}):E.map(e=>{let t=null==k?void 0:k.interests.includes(e.sport);return(0,n.jsxs)("button",{type:"button",onClick:()=>j(e.id),className:"w-full rounded-xl border p-3 text-left text-sm transition ".concat(z===e.id?"border-neon bg-neon/10 text-zinc-100":"border-zinc-800 bg-zinc-900/60 text-zinc-300 hover:border-zinc-600"),children:[(0,n.jsx)("p",{className:"font-semibold",children:e.arena_name}),(0,n.jsxs)("p",{className:"text-xs text-zinc-400",children:[e.sport," â€¢ ",e.topic]}),(0,n.jsxs)("p",{className:"text-[11px] text-zinc-500",children:["Created by ",e.created_by_email]}),t?(0,n.jsx)("p",{className:"mt-1 inline-flex rounded-full border border-neon/70 bg-neon/10 px-2 py-0.5 text-[10px] font-semibold text-neon",children:"Matches your interests"}):null]},e.id)})})]}),(0,n.jsxs)("article",{className:"rounded-2xl border border-zinc-800 bg-zinc-900/70 p-3",children:[(0,n.jsx)("h2",{className:"text-sm font-semibold",children:"Room Discussion"}),z?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"mt-3 max-h-[320px] space-y-2 overflow-y-auto rounded-xl border border-zinc-800 bg-zinc-900/60 p-2",children:0===u.length?(0,n.jsx)("p",{className:"text-sm text-zinc-400",children:"No messages yet. Start the conversation."}):u.map(e=>(0,n.jsxs)("div",{className:"rounded-lg border border-zinc-800 bg-zinc-900/70 p-2 text-sm",children:[(0,n.jsx)("p",{className:"font-semibold",children:e.sender_name}),(0,n.jsx)("p",{className:"text-xs text-zinc-500",children:new Date(e.created_at).toLocaleString()}),(0,n.jsx)("p",{className:"mt-1",children:e.text})]},e.id))}),(0,n.jsxs)("div",{className:"mt-3 flex gap-2",children:[(0,n.jsx)("input",{value:v,onChange:e=>y(e.target.value),onKeyDown:e=>{"Enter"===e.key&&A()},placeholder:"Ask questions or discuss your plan...",className:"w-full rounded-xl border border-zinc-700 bg-zinc-800 px-3 py-2 text-sm text-zinc-100"}),(0,n.jsx)("button",{type:"button",onClick:A,className:"rounded-xl bg-neon px-4 py-2 text-xs font-bold text-zinc-900",children:"Send"})]})]}):(0,n.jsx)("p",{className:"mt-3 text-sm text-zinc-400",children:"Select an arena chat room to start asking questions and discussing plans."})]})]})]}):(0,n.jsx)(o.q,{children:(0,n.jsxs)("section",{className:"rounded-3xl border border-zinc-800 bg-zinc-900/70 p-6",children:[(0,n.jsx)("h1",{className:"text-3xl font-black",children:"Public Arena Chat"}),(0,n.jsx)("p",{className:"mt-2 text-sm text-zinc-400",children:"Please login to join the conversation."}),(0,n.jsx)(r(),{href:"/profile",className:"mt-4 inline-block rounded-xl bg-neon px-4 py-2 text-sm font-bold text-zinc-900",children:"Go To Profile Login"})]})})}},7413:(e,t,s)=>{Promise.resolve().then(s.bind(s,6245))}},e=>{e.O(0,[154,373,546,441,493,358],()=>e(e.s=7413)),_N_E=e.O()}]);